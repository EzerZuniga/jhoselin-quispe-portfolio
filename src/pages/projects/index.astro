---
import PageLayout from "@layouts/PageLayout.astro";
import { ProjectGrid, fetchProjects } from "@modules/projects";

const projects = await fetchProjects();

// Get unique technologies for filter
const allTechnologies = [
  ...new Set(projects.flatMap((p) => p.technologies)),
].slice(0, 8);
---

<PageLayout
  title="Proyectos Académicos"
  description="Proyectos desarrollados durante mi formación en Ingeniería Industrial, aplicando metodologías de mejora continua y análisis de datos."
>
  <!-- Hero -->
  <section class="container-custom section">
    <div class="max-w-3xl mx-auto text-center">
      <span
        class="inline-block px-3 py-1 text-sm font-medium text-primary bg-primary/10 rounded-full mb-4"
      >
        Portafolio
      </span>
      <h1 class="text-4xl sm:text-5xl font-bold text-foreground mb-6">
        Proyectos Académicos
      </h1>
      <p class="text-xl text-muted-foreground">
        Trabajos desarrollados durante mi formación en Ingeniería Industrial, 
        aplicando metodologías de mejora continua y análisis de procesos.
      </p>
    </div>
  </section>

  <!-- Filters -->
  {
    allTechnologies.length > 0 && (
      <section class="container-custom pb-8">
        <div class="flex flex-wrap justify-center gap-2">
          <button
            class="filter-btn px-4 py-2 rounded-full text-sm font-medium bg-primary text-primary-foreground transition-colors duration-200"
            data-filter="all"
          >
            Todos
          </button>
          {allTechnologies.map((tech) => (
            <button
              class="filter-btn px-4 py-2 rounded-full text-sm font-medium bg-secondary text-secondary-foreground hover:bg-secondary/80 transition-colors duration-200"
              data-filter={tech.toLowerCase()}
            >
              {tech}
            </button>
          ))}
        </div>
      </section>
    )
  }

  <!-- Projects Grid -->
  <ProjectGrid projects={projects} showLink={false} />

  <!-- CTA -->
  <section class="container-custom section">
    <div
      class="max-w-3xl mx-auto text-center p-8 sm:p-12 rounded-3xl bg-gradient-to-br from-primary/10 via-accent/10 to-primary/10 border border-primary/20"
    >
      <h2 class="text-2xl sm:text-3xl font-bold text-foreground mb-4">
        ¿Tienes un proyecto en mente?
      </h2>
      <p class="text-muted-foreground mb-6">
        Me encantaría ayudarte a convertir tu idea en realidad. ¡Hablemos!
      </p>
      <a
        href="/contact"
        class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-primary text-primary-foreground font-medium hover:bg-primary/90 transition-all duration-200"
      >
        Iniciar conversación
        <svg
          class="w-5 h-5"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            d="M13.5 4.5L21 12m0 0l-7.5 7.5M21 12H3"></path>
        </svg>
      </a>
    </div>
  </section>
</PageLayout>

<script>
  // Simple filter functionality
  document.addEventListener("DOMContentLoaded", () => {
    const filterButtons = document.querySelectorAll(".filter-btn");
    const projectCards = document.querySelectorAll("[data-technologies]");

    filterButtons.forEach((btn) => {
      btn.addEventListener("click", () => {
        const filter = btn.getAttribute("data-filter");

        // Update button styles
        filterButtons.forEach((b) => {
          b.classList.remove("bg-primary", "text-primary-foreground");
          b.classList.add(
            "bg-secondary",
            "text-secondary-foreground",
            "hover:bg-secondary/80"
          );
        });
        btn.classList.remove(
          "bg-secondary",
          "text-secondary-foreground",
          "hover:bg-secondary/80"
        );
        btn.classList.add("bg-primary", "text-primary-foreground");

        // Filter projects
        projectCards.forEach((card) => {
          const technologies = card.getAttribute("data-technologies")?.toLowerCase() ?? "";
          if (
            filter === "all" ||
            technologies.includes(filter!)
          ) {
            (card as HTMLElement).style.display = "";
          } else {
            (card as HTMLElement).style.display = "none";
          }
        });
      });
    });
  });
</script>
