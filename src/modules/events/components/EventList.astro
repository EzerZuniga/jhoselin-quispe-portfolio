---
import type { EventEntry } from "@app-types/event";
import { formatDate, isFutureDate } from "@utils/formatDate";

interface Props {
  events?: EventEntry[];
  showTitle?: boolean;
  showLink?: boolean;
  limit?: number;
}

const { events = [], showTitle = true, showLink = true, limit }: Props = Astro.props;

const displayEvents = limit ? events.slice(0, limit) : events;
const hasMore = limit ? events.length > limit : false;

// Check if event is upcoming
const isUpcoming = (date: Date): boolean => {
  return isFutureDate(date);
};
---

<section class="bg-card/50 border-y border-border">
  <div class="container-custom section">
    {
      showTitle && (
        <div class="text-center mb-12">
          <span class="inline-block px-3 py-1 text-sm font-medium text-accent bg-accent/10 rounded-full mb-4">
            Actividades
          </span>
          <h2 class="text-3xl sm:text-4xl font-bold text-foreground mb-4">
            Eventos y Participaciones
          </h2>
          <p class="text-muted-foreground max-w-2xl mx-auto">
            Charlas, talleres, conferencias y otras actividades en las que he
            participado o participaré.
          </p>
        </div>
      )
    }

    {
      displayEvents.length === 0 ? (
        <div class="text-center py-16">
          <div class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-secondary flex items-center justify-center">
            <svg
              class="w-10 h-10 text-muted"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"
              />
            </svg>
          </div>
          <h3 class="text-xl font-semibold text-foreground mb-2">
            No hay eventos próximos
          </h3>
          <p class="text-muted-foreground">
            Los eventos aparecerán aquí cuando estén programados.
          </p>
        </div>
      ) : (
        <>
          {/* Timeline */}
          <div class="relative">
            {/* Timeline line */}
            <div class="absolute left-4 md:left-1/2 top-0 bottom-0 w-0.5 bg-border md:-translate-x-1/2" />

            <ol class="space-y-8">
              {displayEvents.map((event, index) => {
                const upcoming = isUpcoming(event.date);
                const isEven = index % 2 === 0;

                return (
                  <li
                    class={`relative flex flex-col md:flex-row gap-4 md:gap-8 ${
                      isEven ? "md:flex-row-reverse" : ""
                    }`}
                  >
                    {/* Timeline dot */}
                    <div class="absolute left-4 md:left-1/2 w-4 h-4 rounded-full border-4 border-background bg-primary md:-translate-x-1/2 z-10">
                    </div>

                    {/* Content card */}
                    <article
                      class={`ml-12 md:ml-0 md:w-[calc(50%-2rem)] p-5 rounded-xl bg-background border border-border hover:border-primary/50 transition-colors ${
                        isEven ? "md:mr-auto" : "md:ml-auto"
                      }`}
                    >
                      {/* Status badge */}
                      {upcoming && (
                        <span class="inline-block px-2 py-1 text-xs font-medium bg-success/10 text-success rounded-full mb-3">
                          Próximo
                        </span>
                      )}

                      {/* Date */}
                      <div class="flex items-center gap-2 text-sm text-muted-foreground mb-2">
                        <svg
                          class="w-4 h-4"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                          stroke-width="2"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"
                          />
                        </svg>
                        <time datetime={event.date.toISOString()}>
                          {formatDate(event.date)}
                        </time>
                      </div>

                      {/* Title */}
                      <h3 class="text-xl font-semibold text-foreground mb-2 hover:text-primary transition-colors">
                        <a href={`/events/${event.slug}`}>{event.title}</a>
                      </h3>

                      {/* Summary */}
                      <p class="text-muted-foreground text-sm mb-4">
                        {event.summary}
                      </p>

                      {/* Location */}
                      {event.location && (
                        <div class="flex items-center gap-2 text-sm text-muted-foreground">
                          <svg
                            class="w-4 h-4"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z"
                            />
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z"
                            />
                          </svg>
                          <span>{event.location}</span>
                        </div>
                      )}

                      {/* Link */}
                      {event.eventUrl && (
                        <a
                          href={event.eventUrl}
                          target="_blank"
                          rel="noopener noreferrer"
                          class="inline-flex items-center gap-1 mt-4 text-sm font-medium text-primary hover:underline"
                        >
                          Más información
                          <svg
                            class="w-4 h-4"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                            stroke-width="2"
                          >
                            <path
                              stroke-linecap="round"
                              stroke-linejoin="round"
                              d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"
                            />
                          </svg>
                        </a>
                      )}
                    </article>
                  </li>
                );
              })}
            </ol>
          </div>

          {hasMore && showLink && (
            <div class="text-center mt-12">
              <a
                href="/events"
                class="inline-flex items-center gap-2 px-6 py-3 bg-secondary text-secondary-foreground rounded-xl font-medium hover:bg-secondary/80 transition-all duration-200"
              >
                Ver todos los eventos
                <svg
                  class="w-5 h-5"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M17 8l4 4m0 0l-4 4m4-4H3"
                  />
                </svg>
              </a>
            </div>
          )}
        </>
      )
    }
  </div>
</section>
