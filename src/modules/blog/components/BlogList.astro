---
import type { BlogPost } from "@app-types/blog";
import { formatDate } from "@utils/formatDate";

interface Props {
  posts?: BlogPost[];
  showTitle?: boolean;
  showLink?: boolean;
  limit?: number;
}

const { posts = [], showTitle = true, showLink = true, limit }: Props = Astro.props;

const displayPosts = limit ? posts.slice(0, limit) : posts;
const hasMore = limit ? posts.length > limit : false;
---

<section class="container-custom section">
  {
    showTitle && (
      <div class="text-center mb-12">
        <span class="inline-block px-3 py-1 text-sm font-medium text-primary bg-primary/10 rounded-full mb-4">
          Blog
        </span>
        <h2 class="text-3xl sm:text-4xl font-bold text-foreground mb-4">
          Últimas Publicaciones
        </h2>
        <p class="text-muted-foreground max-w-2xl mx-auto">
          Artículos sobre desarrollo web, diseño, experiencias y aprendizajes en
          el mundo tech.
        </p>
      </div>
    )
  }

  {
    displayPosts.length === 0 ? (
      <div class="text-center py-16">
        <div class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-secondary flex items-center justify-center">
          <svg
            class="w-10 h-10 text-muted"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="1.5"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"
            />
          </svg>
        </div>
        <h3 class="text-xl font-semibold text-foreground mb-2">
          No hay publicaciones aún
        </h3>
        <p class="text-muted-foreground">
          Las entradas del blog aparecerán aquí cuando se publiquen.
        </p>
      </div>
    ) : (
      <>
        <div class="grid gap-8">
          {displayPosts.map((post, index) => (
            <article
              class={`group relative flex flex-col sm:flex-row gap-6 p-6 rounded-2xl border border-border bg-card hover:border-primary/50 transition-all duration-300 hover:shadow-lg ${
                index === 0 ? "sm:p-8" : ""
              }`}
            >
              {/* Thumbnail */}
              <div
                class={`flex-shrink-0 rounded-xl overflow-hidden bg-gradient-to-br from-primary/10 to-accent/10 ${
                  index === 0
                    ? "w-full sm:w-64 h-48 sm:h-auto"
                    : "w-full sm:w-48 h-40 sm:h-auto"
                }`}
              >
                <img
                  src={post.image || `/images/blog/${post.slug}.jpg`}
                  alt={post.title}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                  loading="lazy"
                  onerror="this.parentElement.innerHTML='<div class=\'flex items-center justify-center h-full\'><svg class=\'w-12 h-12 text-primary/30\' fill=\'none\' viewBox=\'0 0 24 24\' stroke=\'currentColor\'><path stroke-linecap=\'round\' stroke-linejoin=\'round\' stroke-width=\'1\' d=\'M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25\' /></svg></div>'"
                />
              </div>

              {/* Content */}
              <div class="flex flex-col flex-1 min-w-0">
                {/* Meta */}
                <div class="flex items-center gap-3 text-sm text-muted-foreground mb-3">
                  <time datetime={post.date.toISOString()}>
                    {formatDate(post.date)}
                  </time>
                  {post.readingTimeMinutes && (
                    <>
                      <span class="w-1 h-1 rounded-full bg-muted" />
                      <span>{post.readingTimeMinutes} min de lectura</span>
                    </>
                  )}
                </div>

                {/* Title */}
                <h3
                  class={`font-bold text-foreground mb-2 group-hover:text-primary transition-colors ${
                    index === 0 ? "text-2xl" : "text-xl"
                  }`}
                >
                  <a href={`/blog/${post.slug}`} class="hover:underline">
                    {post.title}
                  </a>
                </h3>

                {/* Summary */}
                <p
                  class={`text-muted-foreground mb-4 flex-1 ${
                    index === 0 ? "" : "line-clamp-2"
                  }`}
                >
                  {post.summary}
                </p>

                {/* Tags */}
                {post.tags && post.tags.length > 0 && (
                  <div class="flex flex-wrap gap-2">
                    {post.tags.slice(0, 3).map((tag) => (
                      <span class="px-2 py-1 text-xs font-medium bg-secondary text-secondary-foreground rounded-md">
                        #{tag}
                      </span>
                    ))}
                    {post.tags.length > 3 && (
                      <span class="px-2 py-1 text-xs font-medium text-muted-foreground">
                        +{post.tags.length - 3}
                      </span>
                    )}
                  </div>
                )}
              </div>

              {/* Read more arrow */}
              <div class="hidden sm:flex items-center justify-center w-12 h-12 rounded-full bg-secondary text-muted-foreground group-hover:bg-primary group-hover:text-white transition-all duration-300 self-center flex-shrink-0">
                <svg
                  class="w-5 h-5"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M17 8l4 4m0 0l-4 4m4-4H3"
                  />
                </svg>
              </div>
            </article>
          ))}
        </div>

        {hasMore && showLink && (
          <div class="text-center mt-12">
            <a
              href="/blog"
              class="inline-flex items-center gap-2 px-6 py-3 bg-secondary text-secondary-foreground rounded-xl font-medium hover:bg-secondary/80 transition-all duration-200"
            >
              Ver todas las publicaciones
              <svg
                class="w-5 h-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M17 8l4 4m0 0l-4 4m4-4H3"
                />
              </svg>
            </a>
          </div>
        )}
      </>
    )
  }
</section>
